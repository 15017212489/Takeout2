{"ast":null,"code":"export default {\n  data() {\n    return {\n      loginWay: true,\n      phone: '',\n      pwd: '',\n      showPwd: '',\n      countDown: 0,\n      //倒计时\n      code: '',\n      //短信验证码\n      name: '',\n      captcha: '',\n      //图形验证码\n      alertText: '' //提示文本\n      //alertShow: false, //显示警告\n\n    };\n  },\n\n  methods: {\n    async getCode() {\n      // 产生倒计时\n      if (!this.countDown) {\n        // 提交手机号发送ajax请求\n        const result = await reqSendcode(this.phone);\n\n        if (result.code === 1) {\n          // 请求发送验证码失败\n          this.showTip(result.msg);\n        } else {\n          this.countDown = 30;\n          const interval = setInterval(() => {\n            this.countDown--;\n\n            if (!this.countDown) {\n              clearInterval(interval);\n            }\n          }, 1000);\n        }\n      }\n    },\n\n    //\n    showTip(alertText) {\n      this.alertText = alertText;\n      this.alertShow = true;\n    },\n\n    closeTip() {\n      this.alertText = '';\n      this.alertShow = false;\n    },\n\n    // 前台表单验证后登陆\n    async login() {\n      const {\n        rightPhone,\n        code,\n        phone,\n        name,\n        pwd,\n        captcha,\n        showTip,\n        loginWay\n      } = this;\n\n      if (loginWay) {\n        // 手机验证码登陆\n        if (!rightPhone) {\n          // 手机号不正确\n          showTip('手机号不正确');\n          return;\n        } else if (!/^\\d{6}$/.test(code)) {\n          // 验证码必须是6位数字\n          showTip('验证码必须是6位数字');\n          return;\n        }\n\n        this.result = await reqLoginByPhone(phone, code);\n      } else {\n        // 账号密码登陆\n        if (!name) {\n          // 用户名必须输入\n          showTip('用户名必须输入');\n          return;\n        } else if (!pwd) {\n          // 密码必须输入\n          showTip('密码必须输入');\n          return;\n        } else if (!captcha) {\n          // 验证码必须输入\n          showTip('验证码必须输入');\n          return;\n        }\n\n        this.result = await reqLoginByPwd({\n          name,\n          pwd,\n          captcha\n        });\n      }\n\n      if (this.result.code === 0) {\n        // 存储返回值user\n        this.$store.dispatch('saveUserInfo', this.result.data); // 跳转到personal界面\n\n        this.$router.replace('/personal');\n      } else {\n        // 失败则提示相应的信息\n        showTip(this.result.msg); // 更新图片验证码\n\n        this.getCaptcha(); // 清除验证码输入框数据\n\n        this.captcha = '';\n      }\n    },\n\n    getCaptcha() {\n      this.$refs.captcha.src = 'http://localhost:3000/captcha?time' + Date.now();\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA2DA;EACAA;IACA;MACAC,cADA;MAEAC,SAFA;MAGAC,OAHA;MAIAC,WAJA;MAKAC,YALA;MAKA;MACAC,QANA;MAMA;MACAC,QAPA;MAQAC,WARA;MAQA;MACAC,aATA,CASA;MACA;;IAVA;EAYA,CAdA;;EAeAC;IACA;MACA;MACA;QACA;QACA;;QACA;UACA;UACA;QACA,CAHA,MAGA;UACA;UACA;YACA;;YACA;cACAC;YACA;UACA,CALA,EAKA,IALA;QAMA;MACA;IACA,CAnBA;;IAoBA;IACAC;MACA;MACA;IACA,CAxBA;;IAyBAC;MACA;MACA;IACA,CA5BA;;IA6BA;IACA;MACA;QAAAC;QAAAR;QAAAJ;QAAAK;QAAAJ;QAAAK;QAAAI;QAAAX;MAAA;;MAEA;QAAA;QACA;UACA;UACAW;UACA;QACA,CAJA,MAIA;UACA;UACAA;UACA;QACA;;QACA;MACA,CAXA,MAWA;QAAA;QACA;UACA;UACAA;UACA;QACA,CAJA,MAIA;UACA;UACAA;UACA;QACA,CAJA,MAIA;UACA;UACAA;UACA;QACA;;QACA;UAAAL;UAAAJ;UAAAK;QAAA;MACA;;MACA;QACA;QACA,uDAFA,CAGA;;QACA;MACA,CALA,MAKA;QACA;QACAI,yBAFA,CAGA;;QACA,kBAJA,CAKA;;QACA;MACA;IACA,CAzEA;;IA2EAG;MACA;IACA;;EA7EA;AAfA","names":["data","loginWay","phone","pwd","showPwd","countDown","code","name","captcha","alertText","methods","clearInterval","showTip","closeTip","rightPhone","getCaptcha"],"sourceRoot":"src/pages/Login","sources":["Login.vue"],"sourcesContent":["<template>\r\n  <div class=\"loginContainer\">\r\n    <div class=\"loginInner\">\r\n      <div class=\"login_header\">\r\n        <h2 class=\"login_logo\">XXX外卖</h2>\r\n        <div class=\"login_header_title\">\r\n          <a href=\"javascript:\" :class=\"{on: loginWay}\" @click=\"loginWay=true\">短信登录</a>\r\n          <a href=\"javascript:\" :class=\"{on: !loginWay}\" @click=\"loginWay=false\">密码登录</a>\r\n        </div>\r\n      </div>\r\n      <div class=\"login_content\">\r\n        <form>\r\n          <div :class=\"{on: loginWay}\">\r\n            <section class=\"login_message\">\r\n              <input type=\"tel\" maxlength=\"11\" placeholder=\"手机号\" v-model=\"phone\">\r\n              <button :disabled=\"!rightPhone\" class=\"get_verification\" :class=\"{right_phone: rightPhone}\" @click.prevent=\"getCode\">\r\n                {{ computeTime > 0 ? `已发送(${computeTime})` : '获取验证码' }}\r\n              </button>\r\n            </section>\r\n            <section class=\"login_verification\">\r\n              <input type=\"tel\" maxlength=\"8\" placeholder=\"验证码\" v-model=\"code\">\r\n            </section>\r\n            <section class=\"login_hint\">\r\n              温馨提示：未注册XXX外卖帐号的手机号，登录时将自动注册，且代表已同意\r\n              <a href=\"javascript:\">《用户服务协议》</a>\r\n            </section>\r\n          </div>\r\n          <div :class=\"{on: !loginWay}\">\r\n            <section>\r\n              <section class=\"login_message\">\r\n                <input type=\"text\" maxlength=\"11\" placeholder=\"手机/邮箱/用户名\" v-model=\"name\">\r\n              </section>\r\n              <section class=\"login_verification\">\r\n                <input type=\"text\" maxlength=\"8\" placeholder=\"密码\" v-if=\"showPwd\" v-model=\"pwd\">\r\n                <input type=\"password\" maxlength=\"8\" placeholder=\"密码\" v-else v-model=\"pwd\">\r\n                <div class=\"switch_button\" :class=\"showPwd ? 'on' : 'off'\" @click=\"showPwd=!showPwd\">\r\n                  <div class=\"switch_circle\" :class=\"{right: showPwd}\"></div>\r\n                  <span class=\"switch_text\">{{ showPwd ? 'abc' : '· · ·' }}</span>\r\n                </div>\r\n              </section>\r\n              <section class=\"login_message\">\r\n                <input type=\"text\" maxlength=\"11\" placeholder=\"验证码\" v-model=\"captcha\">\r\n                <img class=\"get_verification\" src=\"http://localhost:4000/captcha\" alt=\"captcha\" @click=\"getCaptcha\" ref=\"captcha\">\r\n              </section>\r\n            </section>\r\n          </div>\r\n          <button class=\"login_submit\" @click=\"login\">登录</button>\r\n        </form>\r\n        <a href=\"javascript:\" class=\"about_us\">关于我们</a>\r\n      </div>\r\n      <a href=\"javascript:\" class=\"go_back\" @click=\"$router.back()\">\r\n        <i class=\"iconfont icon-xiangzuojiantou\"></i>\r\n      </a>\r\n    </div>\r\n  <!-- <AlertTip :alertText=\"alertText\" v-show=\"showAlert\" @loginClose=\"closeTip\"/> -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  export default{\r\n    data(){\r\n        return{\r\n          loginWay: true,\r\n          phone: '',\r\n          pwd: '',\r\n          showPwd: '',\r\n          countDown: 0, //倒计时\r\n          code: '', //短信验证码\r\n          name: '',\r\n          captcha: '', //图形验证码\r\n          alertText: '' //提示文本\r\n          //alertShow: false, //显示警告\r\n        }\r\n    },\r\n    methods: {\r\n      async getCode () {\r\n        // 产生倒计时\r\n        if (!this.countDown) {\r\n          // 提交手机号发送ajax请求\r\n          const result = await reqSendcode(this.phone)\r\n          if (result.code === 1) {\r\n            // 请求发送验证码失败\r\n            this.showTip(result.msg)\r\n          } else {\r\n            this.countDown = 30\r\n            const interval = setInterval(() => {\r\n              this.countDown--\r\n              if (!this.countDown) {\r\n                clearInterval(interval)\r\n              }\r\n            }, 1000)\r\n          }\r\n        }\r\n      },\r\n      //\r\n      showTip (alertText) {\r\n        this.alertText = alertText\r\n        this.alertShow = true\r\n      },\r\n      closeTip () {\r\n        this.alertText = ''\r\n        this.alertShow = false\r\n      },\r\n      // 前台表单验证后登陆\r\n      async login () {\r\n        const {rightPhone, code, phone, name, pwd, captcha, showTip, loginWay} = this\r\n\r\n        if (loginWay) { // 手机验证码登陆\r\n          if (!rightPhone) {\r\n            // 手机号不正确\r\n            showTip('手机号不正确')\r\n            return\r\n          } else if (!/^\\d{6}$/.test(code)) {\r\n            // 验证码必须是6位数字\r\n            showTip('验证码必须是6位数字')\r\n            return\r\n          }\r\n          this.result = await reqLoginByPhone(phone, code)\r\n        } else { // 账号密码登陆\r\n          if (!name) {\r\n            // 用户名必须输入\r\n            showTip('用户名必须输入')\r\n            return\r\n          } else if (!pwd) {\r\n            // 密码必须输入\r\n            showTip('密码必须输入')\r\n            return\r\n          } else if (!captcha) {\r\n            // 验证码必须输入\r\n            showTip('验证码必须输入')\r\n            return\r\n          }\r\n          this.result = await reqLoginByPwd({name, pwd, captcha})\r\n        }\r\n        if (this.result.code === 0) {\r\n          // 存储返回值user\r\n          this.$store.dispatch('saveUserInfo', this.result.data)\r\n          // 跳转到personal界面\r\n          this.$router.replace('/personal')\r\n        } else {\r\n          // 失败则提示相应的信息\r\n          showTip(this.result.msg)\r\n          // 更新图片验证码\r\n          this.getCaptcha()\r\n          // 清除验证码输入框数据\r\n          this.captcha = ''\r\n        }\r\n      },\r\n\r\n      getCaptcha () {\r\n        this.$refs.captcha.src = 'http://localhost:3000/captcha?time' + Date.now()\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\">\r\n  @import \"../../common/style/mixins.less\";\r\n  .loginContainer{\r\n    width: 100%;\r\n    height: 100%;\r\n    background: #fff;\r\n    .loginInner{\r\n      padding-top: 60px;\r\n      width: 80%;\r\n      margin: 0 auto;\r\n      .login_header{\r\n        .login_logo{\r\n          font-size: 40px;\r\n          font-weight: bold;\r\n          color: #02a774;\r\n          text-align: center;\r\n        }\r\n        .login_header_title{\r\n          padding-top: 40px;\r\n          text-align: center;\r\n          >a{\r\n            color: #333;\r\n            font-size: 14px;\r\n            padding-bottom: 4px;\r\n            &:first-child{\r\n              margin-right: 40px;\r\n            }\r\n            &.on{\r\n              color: #02a774;\r\n              font-weight: 700;\r\n              border-bottom: 2px solid #02a774;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      .login_content{\r\n        >form{\r\n          >div{\r\n            display: none;\r\n            &.on{\r\n              display: block;\r\n            }\r\n            input{\r\n              width: 100%;\r\n              height: 100%;\r\n              padding-left: 10px;\r\n              box-sizing: border-box;\r\n              border: 1px solid #ddd;\r\n              border-radius: 4px;\r\n              outline: 0;\r\n              font: 400 14px Arial;\r\n              &:focus{\r\n                border: 1px solid #02a774;\r\n              }\r\n            }\r\n            .login_message{\r\n              position: relative;\r\n              margin-top: 16px;\r\n              height: 48px;\r\n              font-size: 14px;\r\n              background: #fff;\r\n              .get_verification{\r\n                position: absolute;\r\n                top: 50%;\r\n                right: 10px;\r\n                transform: translateY(-50%);\r\n                border: 0;\r\n                color: #ccc;\r\n                font-size: 14px;\r\n                background: transparent;\r\n                &.showBlack{\r\n                  color: black;\r\n                }\r\n              }\r\n            }\r\n            .login_verification{\r\n              position: relative;\r\n              margin-top: 16px;\r\n              height: 48px;\r\n              font-size: 14px;\r\n              background: #fff;\r\n              .switch_button{\r\n                font-size: 12px;\r\n                border: 1px solid #ddd;\r\n                border-radius: 8px;\r\n                transition: background-color .3s,border-color .3s;\r\n                padding: 0 6px;\r\n                width: 30px;\r\n                height: 16px;\r\n                line-height: 16px;\r\n                color: #fff;\r\n                position: absolute;\r\n                top: 50%;\r\n                right: 10px;\r\n                transform: translateY(-50%);\r\n                &.off{\r\n                  background: #fff;\r\n                  .switch_text{\r\n                    float: right;\r\n                    color: #ddd;\r\n                  }\r\n                }\r\n                &.on{\r\n                  background: #02a774;\r\n                }\r\n                >.switch_circle{\r\n                  //transform translateX(27px);\r\n                  position: absolute;\r\n                  top: -1px;\r\n                  left: -1px;\r\n                  width: 16px;\r\n                  height: 16px;\r\n                  border: 1px solid #ddd;\r\n                  border-radius: 50%;\r\n                  background: #fff;\r\n                  box-shadow: 0 2px 4px 0 rgba(0,0,0,.1);\r\n                  transition: transform .3s;\r\n                  &.right{\r\n                    transform: translateX(31px);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            .login_hint{\r\n              margin-top: 12px;\r\n              color: #999;\r\n              font-size: 14px;\r\n              line-height: 20px;\r\n              >a{\r\n                color: #02a774;\r\n              }\r\n            }\r\n          }\r\n          .login_submit{\r\n            display: block;\r\n            width: 100%;\r\n            height: 42px;\r\n            margin-top: 30px;\r\n            border-radius: 4px;\r\n            background: #4cd96f;\r\n            color: #fff;\r\n            text-align: center;\r\n            font-size: 16px;\r\n            line-height: 42px;\r\n            border: 0;\r\n          }\r\n        }\r\n        .about_us{\r\n          display: block;\r\n          font-size: 12px;\r\n          margin-top: 20px;\r\n          text-align: center;\r\n          color: #999;\r\n        }\r\n      }\r\n      .go_back{\r\n        position: absolute;\r\n        top: 5px;\r\n        left: 5px;\r\n        width: 30px;\r\n        height: 30px;\r\n        .icon-xiangzuojiantou{\r\n          line-height: 30px;\r\n          text-align: center;\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}